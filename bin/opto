#!/usr/bin/env ruby
require 'optparse'
require 'byebug'

$:.unshift File.join( File.dirname(__FILE__), "/../lib")

require 'opto'


options = {}
OptionParser.new do |parser|
  parser.on("-s", "--suite test-suite", "Which suite to run") do |lib|
    options[:suite] = lib
  end
end.parse!

server = Opto::Server.new( ARGV.last )

suites = options[:suite]

if suites
  Opto.registered.select {|s| suites.include?(s.short_name) }.each do |op|
    op.new(server).check
  end
else
  Opto.registered.each do |op|
    c = op.new(server)
    c.check
  end
end

server.result.report
